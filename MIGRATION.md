# Monorepo è¿ç§»æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä»æ—§çš„é¡¹ç›®ç»“æ„è¿ç§»åˆ°æ–°çš„ monorepo æ¶æ„ã€‚

## è¿ç§»å®Œæˆçš„å†…å®¹

### âœ… å·²å®Œæˆ

1. **é¡¹ç›®ç»“æ„é‡ç»„**
   - åˆ›å»ºäº† `packages/types` åŒ…ï¼ˆç±»å‹å®šä¹‰ï¼‰
   - åˆ›å»ºäº† `packages/must` åŒ…ï¼ˆä¸»åŠŸèƒ½ï¼‰
   - åˆ›å»ºäº† `playground` æµ‹è¯•ç¯å¢ƒ

2. **Workspace é…ç½®**
   - é…ç½®äº† pnpm workspace
   - è®¾ç½®äº†åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»
   - é…ç½®äº† TypeScript è·¯å¾„åˆ«å

3. **ä»£ç è¿ç§»**
   - æ‰€æœ‰æºä»£ç å·²ç§»è‡³ `packages/must/src/`
   - ç±»å‹å®šä¹‰å·²æå–åˆ° `packages/types/src/`
   - æ›´æ–°äº†æ‰€æœ‰å¯¼å…¥è·¯å¾„

4. **æµ‹è¯•ç¯å¢ƒ**
   - åˆ›å»ºäº†å®Œæ•´çš„ React playground
   - é…ç½®äº† Vite å¼€å‘æœåŠ¡å™¨
   - æ·»åŠ äº† must é…ç½®æ–‡ä»¶

## ç›®å½•å¯¹æ¯”

### æ—§ç»“æ„
```
must/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ extractors/
â”‚   â”œâ”€â”€ translators/
â”‚   â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ examples/
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### æ–°ç»“æ„ï¼ˆMonorepoï¼‰
```
must/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ types/          # ç‹¬ç«‹çš„ç±»å‹åŒ…
â”‚   â””â”€â”€ must/           # ä¸»åŒ…
â”œâ”€â”€ playground/         # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ package.json        # æ ¹é…ç½®
```

## ä¸‹ä¸€æ­¥æ“ä½œ

### 1. å®‰è£…ä¾èµ–

```bash
# ç¡®ä¿å·²å®‰è£… pnpm
npm install -g pnpm

# å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm install
```

### 2. æ„å»ºé¡¹ç›®

```bash
# æ„å»ºæ‰€æœ‰åŒ…
pnpm build
```

è¿™ä¼šï¼š
- æ„å»º `@must/types` åŒ…
- æ„å»º `must` åŒ…

### 3. æµ‹è¯•åŠŸèƒ½

#### æ–¹å¼ä¸€ï¼šåœ¨ Playground ä¸­æµ‹è¯•

```bash
# å¯åŠ¨ playground å¼€å‘æœåŠ¡å™¨
pnpm playground

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼Œè¿›å…¥ playground ç›®å½•
cd playground

# è¿è¡Œ must
pnpm must
```

#### æ–¹å¼äºŒï¼šå…¨å±€é“¾æ¥

```bash
# åœ¨ packages/must ç›®å½•
cd packages/must
pnpm link --global

# ç°åœ¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨
must --help
```

### 4. å¼€å‘å·¥ä½œæµ

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ must åŒ…çš„ç›‘å¬æ¨¡å¼
pnpm --filter must dev

# ç»ˆç«¯ 2ï¼šå¯åŠ¨ playground
pnpm playground

# ç»ˆç«¯ 3ï¼šåœ¨ playground ä¸­æµ‹è¯•
cd playground
pnpm must
```

ç°åœ¨ä¿®æ”¹ `packages/must/src/` ä¸­çš„ä»£ç ä¼šè‡ªåŠ¨é‡æ–°ç¼–è¯‘ï¼Œç„¶åä½ å¯ä»¥ç«‹å³åœ¨ playground ä¸­æµ‹è¯•ã€‚

## æ¸…ç†æ—§æ–‡ä»¶

å®Œæˆè¿ç§»æµ‹è¯•åï¼Œå¯ä»¥æ¸…ç†æ—§çš„æ–‡ä»¶å’Œç›®å½•ï¼š

```bash
# åˆ é™¤æ—§çš„æºä»£ç ç›®å½•ï¼ˆå·²å¤åˆ¶åˆ° packages/must/ï¼‰
rm -rf src/

# åˆ é™¤æ—§çš„ç¤ºä¾‹ç›®å½•ï¼ˆå·²è¢« playground æ›¿ä»£ï¼‰
rm -rf examples/

# åˆ é™¤æ—§çš„é…ç½®æ–‡ä»¶ï¼ˆå·²åœ¨å„ä¸ªåŒ…ä¸­æœ‰æ–°é…ç½®ï¼‰
rm tsconfig.json

# åˆ é™¤æ—§çš„æ–‡æ¡£ï¼ˆå·²æ›´æ–°ä¸º monorepo ç‰ˆæœ¬ï¼‰
rm PROJECT_SUMMARY.md PUBLISH.md EXAMPLES.md
```

## åŒ…ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[must] --> B[@must/types]
    C[playground] --> A
```

- `must` åŒ…ä¾èµ– `@must/types`
- `playground` ä¾èµ– `must`
- ä½¿ç”¨ workspace åè®®ï¼ˆ`workspace:*`ï¼‰ç¡®ä¿ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬

## å¼€å‘å»ºè®®

### æ¨èçš„å¼€å‘æµç¨‹

1. **ä¿®æ”¹ç±»å‹**
   ```bash
   # ç¼–è¾‘ packages/types/src/index.ts
   pnpm --filter @must/types build
   ```

2. **å®ç°åŠŸèƒ½**
   ```bash
   # ç¼–è¾‘ packages/must/src/
   pnpm --filter must dev  # è‡ªåŠ¨é‡æ–°ç¼–è¯‘
   ```

3. **æµ‹è¯•**
   ```bash
   cd playground
   pnpm must  # æµ‹è¯•æ–°åŠŸèƒ½
   ```

4. **æŸ¥çœ‹ç»“æœ**
   ```bash
   # æ£€æŸ¥ playground/src/i18n/ ç›®å½•
   cat playground/src/i18n/en.json
   ```

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨ VS Code è°ƒè¯•**
   - åœ¨ `packages/must/src/` ä¸­è®¾ç½®æ–­ç‚¹
   - ä½¿ç”¨ F5 å¯åŠ¨è°ƒè¯•
   - è°ƒè¯•é…ç½®å·²åœ¨ `.vscode/launch.json`

2. **æŸ¥çœ‹æ—¥å¿—**
   - Must ä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—
   - ä½¿ç”¨ `console.log` æ·»åŠ é¢å¤–æ—¥å¿—

3. **å¿«é€Ÿæµ‹è¯•**
   ```bash
   # ä½¿ç”¨ tsx ç›´æ¥è¿è¡Œï¼ˆæ— éœ€ç¼–è¯‘ï¼‰
   cd packages/must
   npx tsx src/cli.ts --help
   ```

## å‘å¸ƒæµç¨‹

### å‘å¸ƒåˆ° NPM

1. **æ›´æ–°ç‰ˆæœ¬**
   ```bash
   cd packages/must
   npm version patch  # æˆ– minor, major
   ```

2. **æ„å»º**
   ```bash
   pnpm --filter must build
   ```

3. **å‘å¸ƒ**
   ```bash
   cd packages/must
   npm publish
   ```

### å‘å¸ƒç±»å‹åŒ…ï¼ˆå¯é€‰ï¼‰

å¦‚æœæƒ³è®©å…¶ä»–é¡¹ç›®ä¹Ÿèƒ½ä½¿ç”¨ç±»å‹å®šä¹‰ï¼š

```bash
cd packages/types
npm publish --access public
```

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä½¿ç”¨ monorepoï¼Ÿ

A: 
- âœ… æ–¹ä¾¿è°ƒè¯•å’Œæµ‹è¯•
- âœ… ä»£ç å¤ç”¨å’Œå…±äº«
- âœ… ç»Ÿä¸€çš„ä¾èµ–ç®¡ç†
- âœ… æ›´å¥½çš„å¼€å‘ä½“éªŒ

### Q: playground å’Œ examples æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A:
- `playground` æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥è¿è¡Œå’Œè°ƒè¯•
- `examples` åªæ˜¯é™æ€çš„ç¤ºä¾‹æ–‡ä»¶
- `playground` ä½¿ç”¨ workspace ä¾èµ–ï¼Œä¿®æ”¹ä»£ç ç«‹å³ç”Ÿæ•ˆ

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æµ‹è¯•æ¡ˆä¾‹ï¼Ÿ

A: åœ¨ `playground/src/` ä¸­æ·»åŠ æ–°çš„ç»„ä»¶æˆ–é¡µé¢ï¼Œç„¶åè¿è¡Œ `pnpm must` æµ‹è¯•æå–æ•ˆæœã€‚

### Q: å¯ä»¥ä¸ä½¿ç”¨ pnpm å—ï¼Ÿ

A: æ¨èä½¿ç”¨ pnpmï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ npm workspaces æˆ– yarn workspacesï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚

## æ€»ç»“

Monorepo æ¶æ„å¸¦æ¥çš„ä¸»è¦æ”¹è¿›ï¼š

1. **å¼€å‘ä½“éªŒ** â¬†ï¸
   - å®æ—¶é‡æ–°åŠ è½½
   - æ— éœ€é¢‘ç¹å‘å¸ƒ
   - ç»Ÿä¸€çš„å·¥å…·é“¾

2. **æµ‹è¯•ä¾¿åˆ©æ€§** â¬†ï¸
   - å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒ
   - å³æ—¶åé¦ˆ
   - çœŸå®çš„ä½¿ç”¨åœºæ™¯

3. **ä»£ç ç»„ç»‡** â¬†ï¸
   - æ¸…æ™°çš„åŒ…è¾¹ç•Œ
   - ç±»å‹å®‰å…¨
   - æ˜“äºç»´æŠ¤

ç°åœ¨ä½ å¯ä»¥æ›´æ–¹ä¾¿åœ°å¼€å‘å’Œæµ‹è¯• Must å·¥å…·äº†ï¼ğŸ‰
